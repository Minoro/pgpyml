---
layout: documentation
title: Predictions - PGPYML
description:

show_sidebar: true

navigation:
    0 :
        link: predictions
        name: Predictions
        subnavigation:
            0:
                link: casts
                name: Predictions Cast
    1 : 
        link : prediction-on-table
        name : Predict on Table
---

<section id="predictions" class="section">
    <div class="container">
        <h1 class="title">Predictions</h1>

        <p>In this section you will learn how to use your model do precitions over new data and data stored on your database. The examples below assume a table named <span class="emph">iris</span> as follow:</p>

        {% highlight sql%}{% raw %}CREATE TABLE iris (
	id integer generated by default as identity,
	sepal_length float,
	sepal_width float,
	petal_length float,
	petal_width float,
	class VARCHAR(20) -- This column will be filled by pgpyml
);
{% endraw %}{% endhighlight %}

        <p>With your model prepared you can easily make predictions inside your database with <span class="strong">pgpyml</span>. You can use the <span class="emph">predict</span> function to apply your model over the data.</p>
        <p>The <span class="emph">predict</span> function is the easiest way to deploy your model, you only need to specificate the path on your disk to the model and pass and <span class="strong">array</span> of features. This function can be used to predict a single instance or multiple instances at same time. The features must be passed as a nested array, like you usually do in sklearn.</p>

        {% highlight sql%}{% raw%} SELECT * FROM pgpyml.predict(
    '/home/vagrant/examples/iris/models/iris_decision_tree.joblib', 
    '{{5.2,3.5,1.5,0.2}}'
); 
-- Output: {Iris-setosa} (or any other class your model predict)

-- Prediction multiple instances at once
SELECT * FROM pgpyml.predict(
    '/home/vagrant/examples/iris/models/iris_decision_tree.joblib', 
    '{{5.2,3.5,1.5,0.2}, {7.7,2.8,6.7,2.0}}'
);
-- Output: {Iris-setosa,Iris-virginica}

-- You can also use the ARRAY notation
SELECT * FROM pgpyml.predict(
    '/home/vagrant/examples/iris/models/iris_decision_tree.joblib', 
    ARRAY[[5.2,3.5,1.5,0.2], [7.7,2.8,6.7,2.0]]
);
-- Output: {Iris-setosa,Iris-virginica}
        {% endraw %}{% endhighlight %}

        <p>The <span class="emph">predict</span> function expects two arguments, the first argument is the path to your trained model, this path must be reachable by your Postgres server. The second argument is a nested array of instances to be predicted, each element of the array will have an element on the output. The output are an text array with the predictions of your model.</p>
        
        <div id="casts">
            <h2 class="sub-title">Casts</h2>
            <p>The <span class="emph">predict</span> function gives the output as an array of text, this way you can cast the produced output to the suitable type. You can use the "casted" version of <span class="emph">predict</span> to obtain the output casted to <span class="emph">int</span> or <span class="emph">real</span>.</p>
        </div>
        
    </div>

</section>

<section id="prediction-on-table" class="section">
    <div class="container">
        <h2 class="title">Predict on Table</h2>
        <p>You may want to use your model over data that are already stored on your database. To do that you can use the <span class="emph">predict_table_row</span> function.</p>
        <p>This function expects as the first argument the model you want to use, the second argument is the name of the table where the data is stored, the third argument is an array with the name of the columns that will be used as features by your model, and finally the forth argument is the id of the row you want to classify:</p>
        {% highlight sql%}{% raw%} SELECT * FROM pgpyml.predict_table_row(
'/home/vagrant/examples/iris/models/iris_decision_tree.joblib', -- The trained model
'iris', -- Table with the data
'{"sepal_length", "sepal_width", "petal_length", "petal_width"}', -- The columns used as feature
42 -- The ID of your data
);
    {% endraw %}{% endhighlight %}
  
    </div>

</section>

